[TOC]

# 总线舵机伺服舵机通信协议

## 版本历史

##  1. 串口通信配置

## 2. 数据类型说明

含 check_sum 说明

## 3. 舵机控制指令

| 指令 ID (dec) | 指令 ID (hex) | 指令名称                     | 请求数据包 (字节) | 响应数据包 字节) |
| :-----------: | :-----------: | ---------------------------- | :---------------: | ---------------- |
|       1       |     0x01      | 通讯检测                     |         6         |                  |
|       8       |     0x08      | 简易单圈角度控制             |                   |                  |
|      11       |     0x0B      | 高级单圈角度控制（基于时间） |                   |                  |
|      12       |     0x0C      | 高级单圈角度控制（基于速度） |                   |                  |
|      10       |     0x0A      | 当前单圈角度读取             |                   |                  |
|      13       |     0x0D      | 简易多圈角度控制             |                   |                  |
|      14       |     0x0E      | 高级多圈角度控制（基于时间） |        20         |                  |
|      15       |     0x0F      | 高级多圈角度控制（基于速度） |        20         |                  |
|      16       |     0x10      | 当前多圈角度读取             |                   |                  |
|      17       |     0x11      | 重置圈数                     |                   |                  |
|       9       |     0x09      | 阻尼控制                     |                   |                  |
|      24       |     0x18      | 停止指令                     |                   |                  |
|      25       |     0x19      | 同步指令                     |                   |                  |
|      18       |     0x12      | 异步写入指令                 |                   |                  |
|      19       |     0x13      | 异步执行指令                 |                   |                  |
|       3       |     0x03      | 数据读取                     |                   |                  |
|      22       |     0x16      | 数据监控                     |                   |                  |
|      23       |     0x17      | 设置原点                     |                   |                  |
|       4       |     0x04      | 自定义配置参数               |                   |                  |
|       5       |     0x05      | 批量读取数据（内部）         |                   |                  |
|       6       |     0x06      | 批量写入数据（内部）         |                   |                  |
|       2       |     0x02      | 恢复出厂配置                 |                   |                  |

## 4. 数据包格式详解

### 4.1. 请求数据包

### 4.2. 响应数据包

### 4.3 校验码计算



## 5. 通讯检测

**请求数据**

| 字节位 | 参数名     | 长度 |  数据类型  | 说明                         |
| :----: | ---------- | :--: | :--------: | ---------------------------- |
|  0-1   | `cmd_hdr`  |  2   | 无符号整数 | 固定值 (0x12 0x4c)           |
|   2    | `cmd_id`   |  1   | 无符号整数 | 通讯检测 (0x01)              |
|   3    | `cmd_size` |  1   | 无符号整数 | 1 byte (0x01)                |
|   4    | `servo_id` |  1   | 无符号整数 | 舵机 ID                      |
|   5    | `checksum` |  1   | 无符号整数 | 校验码 = Σ(Byte[0..5]) % 256 |

```
0x12 0x4c 0x01 0x01 0x08 0x68
```

**示例说明：**

- 检查8号舵机是否在线。

**响应数据**

| 字节位 | 参数名     | 长度 |  数据类型  | 说明                         |
| :----: | ---------- | :--: | :--------: | ---------------------------- |
|  0-1   | `resp_hdr` |  2   | 无符号整数 | 固定值 (0x05 0x1c)           |
|   2    | `cmd_id`   |  1   | 无符号整数 | 通讯检测 (0x01)              |
|   3    | `cmd_size` |  1   | 无符号整数 | 1 byte (0x01)                |
|   4    | `servo_id` |  1   | 无符号整数 | 舵机 ID                      |
|   5    | `checksum` |  1   | 无符号整数 | 校验码 = Σ(Byte[0..5]) % 256 |

```
0x05 0x1c 0x01 0x01 0x08 0x2b
```

**示例说明：**

- 计算并比较理论 `checksum` 与响应报文中的 `checksum`：若一致，则判定 **8 号舵机在线**。
- 建议设置最大等待时间`timeout`，如果超过时间没有收到，则代表舵机不在线。





**Request Package**

|    0-1    |   2    |  3   |    4     |    5     |
| :-------: | :----: | :--: | :------: | :------: |
|  cmd_hdr  | cmd_id | size | servo_id | checksum |
|    2B     |   1B   |  1B  |    1B    |    1B    |
| 0x12 0x4c |  0x01  | 0x01 |   0x08   |   0x68   |

```
0x12 0x4c 0x01 0x01 0x08 0x68
```

**示例说明：**

- 检查8号舵机是否在线。



**Response Package**

|    0-1    |   2    |  3   |    4     |    5     |
| :-------: | :----: | :--: | :------: | :------: |
|  cmd_hdr  | cmd_id | size | servo_id | checksum |
|     2     |   1    |  1   |    1     |    1     |
| 0x05 0x1c |  0x01  | 0x01 |   0x08   |   0x2b   |

```
0x05 0x1c 0x01 0x01 0x08 0x2b
```

**示例说明：**

- 计算并比较理论 `checksum` 与响应报文中的 `checksum`：若一致，则判定 **8 号舵机在线**。
- 建议设置最大等待时间`timeout`，如果超过时间没有收到，则代表舵机不在线。





## 6. 简易单圈角度控制

**请求数据**

| 序号 | 参数名     | 长度 |  数据类型  | 说明                                                         |
| :--: | ---------- | :--: | :--------: | ------------------------------------------------------------ |
| 0-1  | `cmd_hdr`  |  2   | 无符号整数 | 固定值 (0x12 0x4c)                                           |
|  2   | `cmd_id`   |  1   | 无符号整数 | 简易单圈角度控制 (0X08)                                      |
|  3   | `cmd_size` |  1   | 无符号整数 | 7 bytes                                                      |
|  4   | `servo_id` |  1   | 无符号整数 | 0 ~ 254                                                      |
| 5-6  | `tgt_pos`  |  2   |    整数    | 目标角度-180° ~ +180° (-1800 ~ +1800)                        |
| 7-8  | `mot_time` |  2   | 无符号整数 | 从当前位置到目标位置的运动时间                               |
| 9-10 | `power`    |  2   | 无符号整数 | **0:** 最大功率 当 `power = 0` 或超过 **功率保持值** 时，按 **功率保持值** 执行 |
|  11  | `checksum` |  1   | 无符号整数 | 对0 - 10字节数据求和，然后跟256取余                          |

![sent](./aseets_protocol/sent.png)

```
0x12 0x4c 0x08 0x07 0x02 0x84 0x03 0xf4 0x01 0x00 0x00 0xeb
```

**示例说明：**

- 设置8号舵机，在500ms内，以最大执行功率旋转到90°。





**参数说明**

- `servo_id`: 舵机 ID，0xff为所有在线舵机

- `tgt_pos`: 单位: 0.1°/实际输入范围-1,800~+1,800，**符号表示方向**；

- `mot_time`: 单位ms

- `power`:单位: mW/ **0:** 表示以最大功率执行|**非零值:** 按设定值执行

  (当 power =0或设定值大于功率保持值时，系统将按照**功率保护阈值**进行执行。)

**请求数据**

|   0 - 1   |    2     |   3    |     4      |   5 - 6   |   7 - 8    |  9 - 10   |    11    |
| :-------: | :------: | :----: | :--------: | :-------: | :--------: | :-------: | :------: |
| `cmd_hdr` | `cmd_id` | `size` | `servo_id` | `tgt_pos` | `mot_time` |   power   | checksum |
|     2     |    1     |   1    |     1      |     2     |     2      |     2     |    1     |
| 0x12 0x4C |   0x08   |  0x07  |    0x08    | 0x84 0x03 | 0xf4 0x01  | 0x00 0x00 |   0x68   |

![resp](./aseets_protocol/sent.png)

```
0x12 0x4c 0x08 0x07 0x02 0x84 0x03 0xf4 0x01 0x00 0x00 0xeb
```

**示例说明：**

- 设置8号舵机，在500ms内，以最大执行功率旋转到90°。









**参数说明**

**响应数据包**

![resp](./aseets_protocol/resp.png)

> **示例说明：**收到结果为1，指令执行成功。

```
0x05 0x1C 0x08 0x02 0x08 0x01 0xB3
```

> [!CAUTION]
>
> **注意事项：**默认没有响应包，只有**指令送出响应开关 = 是**打开响应开关时候才有

**参数说明**

| 序号 | 参数名        | 单位 | 范围 / 值域                    | 说明                                                         |
| :--: | ------------- | :--: | ------------------------------ | ------------------------------------------------------------ |
| 0-1  | `resp_hdr`    |  -   | 0x05 0x1C                      | 固定值                                                       |
|  2   | `cmd_id`      |  -   | 0x08                           | 简易单圈角度控制                                             |
|  3   | `resp_size`   |  -   | 0x02                           | 2字节                                                        |
|  4   | `servo_id`    |  -   | 0 ~ 254                        |                                                              |
|  5   | `resp_result` |  -   | **1:** 执行成功 \| **0:** 失败 | **注意事项：**默认不响应，上位机`指令送出响应`**打开**才有此数据。 |
|  6   | `checksum`    |  -   |                                | 对0 - 5字节数据求和，然后跟256取余                           |



## 7. 高级单圈角度控制 (基于时间)

**请求数据包**

| 字节序号     |   0 - 1   |   2    |    3     |   4    |   5 - 6   |   7 - 8   |  9 - 10   |  11 - 12  |  13 - 14  |   15   |
| ------------ | :-------: | :----: | :------: | :----: | :-------: | :-------: | :-------: | :-------: | :-------: | :----: |
| **字节名称** |  指令头   | 指令ID | 指令长度 | 舵机ID | 目标角度  | 运动时间  | 执行功率  | 加速时间  | 减速时间  | 校验码 |
| **字节长度** |     2     |   1    |    1     |   1    |     2     |     2     |     2     |     2     |     2     |   1    |
| **示 例**    | 0x12 0x4C |  0x08  |   0x0B   |  0x08  | 0x84 0x03 | 0xf4 0x01 | 0x00 0x00 | 0x64 0x00 | 0x64 0x00 |  0xF1  |

> **示例说明：**设置8号舵机，在500ms内，以最大执行功率旋转到90°。

```
0x12 0x4c 0x08 0x07 0x02 0x84 0x03 0xf4 0x01 0x00 0x00 0xeb
```

**响应数据包**

| 字节序号     |   0 - 1   |   2    |  3   |    4     |      5      |    6     |
| ------------ | :-------: | :----: | :--: | :------: | :---------: | :------: |
| **字节名称** | resp_hdr  | cmd_id | size | servo_id | resp_result | checksum |
| **字节长度** |     2     |   1    |  1   |    1     |      1      |    1     |
| **示 例**    | 0x05 0x1C |  0x08  | 0x02 |   0x08   |    0x01     |   0xB3   |

> **示例说明：**收到结果为1，指令执行成功。

```
0x05 0x1C 0x08 0x02 0x08 0x01 0xB3
```

> [!CAUTION]
>
> 默认没有响应包，只有指令送出响应开关=是打开响应开关时候才有

## 8. 高级单圈角度控制 (基于速度)

### 

## 9. 单圈当前角度读取



## 10. 简易多圈角度控制

## 11. 高级多圈角度控制 (基于时间)

## 12. 高级多圈角度控制 (基于速度)

## 

## 13. 多圈当前角度读取

## 14. 重置圈数

## 15. 阻尼控制

## 16. 停止指令

## 17. 同步指令

## 18. 异步写入指令

## 19. 异步执行指令

## 20. 数据读取

## 21. 数据监控

## 11. 设置原点

## 12. 自定义配置参数

## 批量读取数据（内部）

## 批量写入数据（内部）

## 恢复出厂配置

### 注意事项：只读参数

## 

## 附录

### 1、自定义参数列表

### 2、只读参数列表





## 6. Single-Turn Position Control

### 6.1 Single-Turn Position Control (Basic)

- **Target Angle (unit: 0.1°)**: -180° ~ +180° (actual input range: -1,800 ~ +1,800)
- **Motion Time (unit: ms)**: 0 ~ 65,535
- **Execution Power (unit: mW)**: `0` → execute at maximum power | non-zero value → execute at the specified value
- (When `power = 0` or the specified value exceeds the **power holding value**, the system will execute according to the **power holding value**.)

| Byte Index          |   0 - 1   |   2    |  3   |    4     |   5 - 6   |   7 - 8   | 9 - 10    |    11     |
| ------------------- | :-------: | :----: | :--: | :------: | :-------: | :-------: | --------- | :-------: |
| **Byte Name**       |  cmd_hdr  | cmd_id | size | servo_id |  tgt_pos  | mot_time  | power     | check_sum |
| **Size (in Bytes)** |     2     |   1    |  1   |    1     |     2     |     2     | 2         |     1     |
| **Examples**        | 0x12 0x4c |  0x08  | 0x07 |   0x08   | 0x84 0x03 | 0xf4 0x01 | 0x00 0x00 |   0xF1    |

### 6.2. Single-Turn Position Control (Advanced - Time-based)



### 6.3. Single-Turn Position Control (Advanced - Speed-based)

- **角度范围**：-180° ~ +180°

  > [!NOTE]
  >
  > 控制精度为 0.1° → 实际输入范围 -1800 ~ +1800。

- **运动时间**：0 ~ 65,535 ms

- **执行功率 (单位：mw)** 

  - `0` → 表示以最大功率执行

  - 非零值 → 按设定值执行

  > [!WARNING]
  >
  > 当 `power = 0` 或设定值大于 **功率保持值** 时，系统将按照 **功率保持值** 进行执行。



- 执行功率一般设置为0 `power=0x00 0x00`
- 字节长度 `n= 1+2+2+2 = 7 = 0x07`

> [!TIP]
> 控制精度为 0.1° → 实际输入范围 -1800 ~ +1800。

> [!WARNING]
> 当 `power = 0` 或设定值大于保持值时，系统会按保持值执行。

| 字节序号 | 数据类型 | 字段名称 | 字段功能描述                                                 | 字节长度 |
| :------- | :------- | :------- | :----------------------------------------------------------- | :------- |
| 4        | uint8_t  | servo_id | 舵机ID                                                       | 1        |
| [5，6]   | int16_t  | angle    | 舵机角度，数值正负代表方向( 单位0.1度，举例 `angle=900` 就等于90度) | 2        |
| [7，8]   | uint16_t | interval | 到达目标角度的时间 (单位ms)                                  | 2        |
| [9，10]  | uint16_t | power    | 执行功率(单位mW) 如果power=0或者大于功率保持值，按照功率保持值操作 | 2        |

**响应包内容格式(可选)**

| 字节序号 | 数据类型 | 字段名称 | 字段功能描述               | 字节长度 |
| :------- | :------- | :------- | :------------------------- | :------- |
| 4        | uint8_t  | servo_id | 舵机ID                     | 1        |
| 5        | uint8_t  | result   | 设置结果(0：失败，1：成功) | 1        |

**注意事项：**

1. 默认没有响应包，只有打开 *响应开关* 的时候，才会有响应包。
2. 打开 *响应开关* 后，舵机在旋转到目标角度后，才会发送响应包。
3. 在通讯时，字节顺序使用的是 *小端字节序* 。要注意两个字节的数据，例如角度 `angle = 900 = 0x0384`，在发送时就变成了 `0x84 0x03`。

**数据包示例**

设置2号舵机在500ms内，旋转到90度

**请求数据包**

```
0x12 0x4c 0x08 0x07 0x02 0x84 0x03 0xf4 0x01 0x00 0x00 0xeb
```

- 角度模式控制-设置舵机角度的指令 `cmd_id = 0x08`
- 舵机ID `servo_id = 2 = 0x02`
- 舵机的目标角度为90度，但是 `angle`的单位是 `0.1`度，所以 `angle = 900= 0x84 0x03`
- 时间间隔 `interval=500 = 0xf4 0x01`
- 执行功率一般设置为0 `power=0x00 0x00`
- 字节长度 `n= 1+2+2+2 = 7 = 0x07`
- 校验和 `checksum= (0x12 + 0x4c + 0x08 + 0x07 + 0x02 + 0x84 + 0x03 + 0x0F4 + 0x01 + 0x00 + 0x00)%256 = 235 =0xEB`

### 

